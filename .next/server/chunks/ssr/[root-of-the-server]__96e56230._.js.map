{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../app/admin/bookings/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\ntype BookingRow = {\n  id: string;\n  createdAt: string;\n  timezone: string | null;\n  lead: {\n    email: string;\n    phone: string;\n    country: string;\n    timezone: string;\n  };\n  slot: {\n    startsAt: string;\n    endsAt: string;\n  };\n};\n\nfunction fmt(iso: string) {\n  const d = new Date(iso);\n  return d.toLocaleString(undefined, {\n    weekday: \"short\",\n    day: \"2-digit\",\n    month: \"short\",\n    year: \"numeric\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n}\n\nfunction waLink(phone: string) {\n  // WhatsApp expects digits only (no spaces, no +)\n  const digits = phone.replace(/\\D/g, \"\");\n  return `https://wa.me/${digits}`;\n}\n\nexport default function AdminBookingsPage() {\n  const router = useRouter();\n\n  const [bookings, setBookings] = useState<BookingRow[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  const [onlyUpcoming, setOnlyUpcoming] = useState(true);\n\n  const apiUrl = useMemo(() => {\n    const q = onlyUpcoming ? \"?upcoming=1\" : \"\";\n    return `/api/admin/bookings${q}`;\n  }, [onlyUpcoming]);\n\n  async function load() {\n    setError(\"\");\n    setLoading(true);\n    try {\n      const res = await fetch(apiUrl, { cache: \"no-store\" });\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok) throw new Error(data?.error || `Failed (${res.status})`);\n      setBookings(Array.isArray(data?.bookings) ? data.bookings : []);\n    } catch (e: any) {\n      setError(e?.message || \"Failed to load.\");\n      setBookings([]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function copy(text: string) {\n    navigator.clipboard?.writeText(text).catch(() => {});\n  }\n\n  function exportCsv() {\n    const header = [\n      \"bookingId\",\n      \"start\",\n      \"end\",\n      \"deviceTimezone\",\n      \"leadEmail\",\n      \"leadPhone\",\n      \"leadCountry\",\n      \"leadTimezone\",\n      \"createdAt\",\n    ];\n\n    const lines = bookings.map((b) => [\n      b.id,\n      b.slot.startsAt,\n      b.slot.endsAt,\n      b.timezone || \"\",\n      b.lead.email,\n      b.lead.phone,\n      b.lead.country,\n      b.lead.timezone,\n      b.createdAt,\n    ]);\n\n    const csv = [header, ...lines]\n      .map((row) =>\n        row\n          .map((cell) => `\"${String(cell).replaceAll(`\"`, `\"\"`)}\"`)\n          .join(\",\")\n      )\n      .join(\"\\n\");\n\n    const blob = new Blob([csv], { type: \"text/csv;charset=utf-8;\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = \"bookings.csv\";\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  useEffect(() => {\n    load();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [apiUrl]);\n\n  return (\n    <div className=\"section\">\n      <div className=\"card\">\n        <div className=\"badge\">Admin</div>\n        <h1 className=\"h1\" style={{ fontSize: 44, marginTop: 12 }}>\n          Bookings & client contacts\n        </h1>\n        <p className=\"p\">\n          Use this list to message clients on WhatsApp. You can also export CSV.\n        </p>\n\n        <div style={{ display: \"flex\", gap: 12, flexWrap: \"wrap\", marginTop: 14 }}>\n          <button className=\"btn btnGhost\" onClick={() => router.push(\"/admin/slots\")}>\n            Slots\n          </button>\n\n          <button className=\"btn btnGhost\" onClick={() => router.push(\"/\")}>\n            Home\n          </button>\n\n          <button className=\"btn btnGhost\" onClick={load} disabled={loading}>\n            {loading ? \"Refreshing...\" : \"Refresh\"}\n          </button>\n\n          <button className=\"btn btnGhost\" onClick={exportCsv} disabled={bookings.length === 0}>\n            Export CSV\n          </button>\n\n          <label className=\"p\" style={{ display: \"flex\", gap: 10, alignItems: \"center\" }}>\n            <input\n              type=\"checkbox\"\n              checked={onlyUpcoming}\n              onChange={(e) => setOnlyUpcoming(e.target.checked)}\n            />\n            Show only upcoming\n          </label>\n        </div>\n\n        {error && (\n          <div className=\"card\" style={{ borderColor: \"rgba(255,120,120,0.6)\", marginTop: 14 }}>\n            <b style={{ color: \"#ffd4d4\" }}>Fix this</b>\n            <div className=\"p\" style={{ marginTop: 6 }}>\n              {error}\n            </div>\n            <div className=\"p\" style={{ marginTop: 8, opacity: 0.9 }}>\n              If you see “Unauthorized”, it means your admin email isn’t allowed. Add it to\n              ADMIN_EMAILS / ADMIN_EMAIL in your env vars.\n            </div>\n          </div>\n        )}\n\n        <div className=\"card\" style={{ marginTop: 14 }}>\n          {loading ? (\n            <div className=\"p\">Loading...</div>\n          ) : bookings.length === 0 ? (\n            <div className=\"p\">No bookings found.</div>\n          ) : (\n            <div style={{ display: \"grid\", gap: 12 }}>\n              {bookings.map((b) => (\n                <div key={b.id} className=\"card\" style={{ background: \"rgba(10,16,32,0.35)\" }}>\n                  <div style={{ display: \"flex\", justifyContent: \"space-between\", gap: 12 }}>\n                    <div>\n                      <div style={{ fontWeight: 800, fontSize: 18 }}>\n                        {fmt(b.slot.startsAt)} → {fmt(b.slot.endsAt)}\n                      </div>\n\n                      <div className=\"p\" style={{ marginTop: 6, opacity: 0.9 }}>\n                        <b>Email:</b> {b.lead.email}{\" \"}\n                        <button className=\"btn btnGhost\" style={{ padding: \"6px 10px\", marginLeft: 8 }}\n                          onClick={() => copy(b.lead.email)}>\n                          Copy\n                        </button>\n                      </div>\n\n                      <div className=\"p\" style={{ marginTop: 6, opacity: 0.9 }}>\n                        <b>WhatsApp:</b> {b.lead.phone}{\" \"}\n                        <button className=\"btn btnGhost\" style={{ padding: \"6px 10px\", marginLeft: 8 }}\n                          onClick={() => copy(b.lead.phone)}>\n                          Copy\n                        </button>{\" \"}\n                        <a className=\"btn btnPrimary\" style={{ padding: \"6px 10px\", marginLeft: 8 }}\n                          href={waLink(b.lead.phone)} target=\"_blank\" rel=\"noreferrer\">\n                          Open chat\n                        </a>\n                      </div>\n\n                      <div className=\"p\" style={{ marginTop: 8, opacity: 0.8 }}>\n                        <b>Device TZ:</b> {b.timezone || \"N/A\"} • <b>Lead TZ:</b> {b.lead.timezone} •{\" \"}\n                        <b>Country:</b> {b.lead.country}\n                      </div>\n\n                      <div className=\"p\" style={{ marginTop: 6, opacity: 0.75 }}>\n                        <b>Booking ID:</b> {b.id}{\" \"}\n                        <button className=\"btn btnGhost\" style={{ padding: \"6px 10px\", marginLeft: 8 }}\n                          onClick={() => copy(b.id)}>\n                          Copy\n                        </button>\n                      </div>\n                    </div>\n\n                    <div className=\"p\" style={{ opacity: 0.7, whiteSpace: \"nowrap\" }}>\n                      Created: {fmt(b.createdAt)}\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["module","exports","require","vendored","React","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime"],"mappings":"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","ignoreList":[0,1,2,3,4,5]}