{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/app-router-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../app/onboarding/book/page.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].AppRouterContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","\"use client\";\n\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\ntype SlotRow = {\n  id: string;\n  startsAt: string; // ISO\n  endsAt: string;   // ISO\n};\n\nfunction getCookie(name: string) {\n  if (typeof document === \"undefined\") return null;\n  const parts = document.cookie.split(\";\").map((p) => p.trim());\n  const hit = parts.find((p) => p.startsWith(name + \"=\"));\n  if (!hit) return null;\n  return decodeURIComponent(hit.split(\"=\").slice(1).join(\"=\"));\n}\n\nfunction formatSlot(iso: string) {\n  const d = new Date(iso);\n  return d.toLocaleString(undefined, {\n    weekday: \"short\",\n    day: \"2-digit\",\n    month: \"short\",\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n}\n\nexport default function BookStep() {\n  const router = useRouter();\n\n  const [slots, setSlots] = useState<SlotRow[]>([]);\n  const [selectedId, setSelectedId] = useState<string>(\"\");\n  const [loadingSlots, setLoadingSlots] = useState(false);\n  const [booking, setBooking] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [okMsg, setOkMsg] = useState(\"\");\n\n  const deviceTz = useMemo(() => {\n    return Intl.DateTimeFormat().resolvedOptions().timeZone || \"Asia/Colombo\";\n  }, []);\n\n  async function loadSlots() {\n    setError(\"\");\n    setLoadingSlots(true);\n\n    try {\n      const res = await fetch(\"/api/onboarding/slots\", { cache: \"no-store\" });\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok) throw new Error(data?.error || `Failed to load slots (${res.status})`);\n\n      const list = Array.isArray(data?.slots) ? data.slots : [];\n      setSlots(list);\n\n      // keep selection if still exists; otherwise select first\n      if (list.length > 0) {\n        const stillThere = list.some((s: SlotRow) => s.id === selectedId);\n        if (!selectedId || !stillThere) setSelectedId(list[0].id);\n      } else {\n        setSelectedId(\"\");\n      }\n    } catch (e: any) {\n      setError(e?.message || \"Could not load slots.\");\n      setSlots([]);\n      setSelectedId(\"\");\n    } finally {\n      setLoadingSlots(false);\n    }\n  }\n\n  useEffect(() => {\n    const terms = getCookie(\"nexus_terms\");\n    if (!terms) {\n      router.push(\"/onboarding/terms\");\n      return;\n    }\n\n    const leadId = getCookie(\"nexus_lead\");\n    if (!leadId) {\n      router.push(\"/onboarding/details\");\n      return;\n    }\n\n    loadSlots();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  async function onBook() {\n    setError(\"\");\n    setOkMsg(\"\");\n\n    const leadId = getCookie(\"nexus_lead\");\n    if (!leadId) {\n      setError(\"Missing lead id. Go back to Step 2 and click Next again.\");\n      return;\n    }\n    if (!selectedId) {\n      setError(\"Please select a slot.\");\n      return;\n    }\n\n    setBooking(true);\n    try {\n      const res = await fetch(\"/api/onboarding/book\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          slotId: selectedId,\n          timezone: deviceTz,\n        }),\n      });\n\n      const data = await res.json().catch(() => ({}));\n      if (!res.ok) throw new Error(data?.error || `Booking failed (${res.status})`);\n\n      const bookingId = data?.bookingId || data?.booking?.id;\n      setOkMsg(\"Booked! Redirecting...\");\n\n      // refresh slots so it disappears immediately\n      await loadSlots();\n\n      // go to thank-you screen\n      if (bookingId) {\n        router.push(`/onboarding/confirmed?b=${encodeURIComponent(bookingId)}`);\n      } else {\n        // fallback if something weird happens\n        router.push(`/onboarding/confirmed`);\n      }\n    } catch (e: any) {\n      setError(e?.message || \"Booking failed.\");\n    } finally {\n      setBooking(false);\n    }\n  }\n\n  return (\n    <div className=\"section\">\n      <div className=\"card\">\n        <div className=\"badge\">Step 3 of 3</div>\n        <h1 className=\"h1\" style={{ fontSize: 44, marginTop: 12 }}>\n          Book your onboarding call\n        </h1>\n        <p className=\"p\">Select a slot below. Times are shown in your device time.</p>\n\n        <div className=\"card\" style={{ marginTop: 14 }}>\n          {loadingSlots ? (\n            <div className=\"p\">Loading slots...</div>\n          ) : slots.length === 0 ? (\n            <div className=\"p\">No slots available right now. Please check back later.</div>\n          ) : (\n            <div style={{ display: \"grid\", gap: 12 }}>\n              {slots.map((s) => {\n                const active = selectedId === s.id;\n                return (\n                  <label\n                    key={s.id}\n                    className=\"card\"\n                    style={{\n                      cursor: \"pointer\",\n                      borderColor: active ? \"rgba(120,200,255,0.8)\" : \"rgba(255,255,255,0.12)\",\n                      background: active ? \"rgba(10,16,32,0.65)\" : \"rgba(10,16,32,0.35)\",\n                    }}\n                  >\n                    <div style={{ display: \"flex\", gap: 12, alignItems: \"center\" }}>\n                      <input\n                        type=\"radio\"\n                        name=\"slot\"\n                        checked={active}\n                        onChange={() => setSelectedId(s.id)}\n                      />\n                      <div>\n                        <div style={{ fontWeight: 800, fontSize: 20 }}>\n                          {formatSlot(s.startsAt)}\n                        </div>\n                        <div className=\"p\" style={{ marginTop: 4, opacity: 0.85 }}>\n                          Ends: {formatSlot(s.endsAt)}\n                        </div>\n                      </div>\n                    </div>\n                  </label>\n                );\n              })}\n            </div>\n          )}\n        </div>\n\n        {error && (\n          <div className=\"card\" style={{ borderColor: \"rgba(255,120,120,0.6)\", marginTop: 14 }}>\n            <b style={{ color: \"#ffd4d4\" }}>Fix this</b>\n            <div className=\"p\" style={{ marginTop: 6 }}>\n              {error}\n            </div>\n          </div>\n        )}\n\n        {okMsg && (\n          <div className=\"card\" style={{ borderColor: \"rgba(120,255,160,0.35)\", marginTop: 14 }}>\n            <b style={{ color: \"#d6ffe3\" }}>Done</b>\n            <div className=\"p\" style={{ marginTop: 6 }}>\n              {okMsg}\n            </div>\n          </div>\n        )}\n\n        <div style={{ display: \"flex\", gap: 12, flexWrap: \"wrap\", marginTop: 16 }}>\n          <button className=\"btn btnGhost\" onClick={() => router.push(\"/onboarding/details\")}>\n            Back\n          </button>\n          <button className=\"btn btnPrimary\" onClick={onBook} disabled={booking || slots.length === 0}>\n            {booking ? \"Booking...\" : \"Book\"}\n          </button>\n          <button className=\"btn btnGhost\" onClick={loadSlots} disabled={loadingSlots}>\n            Refresh slots\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":["module","exports","require","vendored","React","AppRouterContext","HooksClientContext","ServerInsertedHtml","process","env","NEXT_RUNTIME","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","ReactJsxRuntime"],"mappings":"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","ignoreList":[0,1,2,3,4,5]}