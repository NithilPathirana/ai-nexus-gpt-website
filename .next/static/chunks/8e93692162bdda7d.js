(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,s,t)=>{s.exports=e.r(76562)},44450,e=>{"use strict";var s=e.i(43476),t=e.i(71645),i=e.i(18566);function o(e){if("u"<typeof document)return null;let s=document.cookie.split(";").map(e=>e.trim()).find(s=>s.startsWith(e+"="));return s?decodeURIComponent(s.split("=").slice(1).join("=")):null}function a(e){return new Date(e).toLocaleString(void 0,{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}function n(){let e=(0,i.useRouter)(),[n,l]=(0,t.useState)([]),[r,d]=(0,t.useState)(""),[c,h]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1),[g,p]=(0,t.useState)(""),[b,f]=(0,t.useState)(""),y=(0,t.useMemo)(()=>Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Colombo",[]);async function x(){p(""),h(!0);try{let e=await fetch("/api/onboarding/slots",{cache:"no-store"}),s=await e.json().catch(()=>({}));if(!e.ok)throw Error(s?.error||`Failed to load slots (${e.status})`);let t=Array.isArray(s?.slots)?s.slots:[];if(l(t),t.length>0){let e=t.some(e=>e.id===r);r&&e||d(t[0].id)}else d("")}catch(e){p(e?.message||"Could not load slots."),l([]),d("")}finally{h(!1)}}async function j(){if(p(""),f(""),!o("nexus_lead"))return void p("Missing lead id. Go back to Step 2 and click Next again.");if(!r)return void p("Please select a slot.");u(!0);try{let s=await fetch("/api/onboarding/book",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slotId:r,timezone:y})}),t=await s.json().catch(()=>({}));if(!s.ok)throw Error(t?.error||`Booking failed (${s.status})`);let i=t?.bookingId||t?.booking?.id;f("Booked! Redirecting..."),await x(),i?e.push(`/onboarding/confirmed?b=${encodeURIComponent(i)}`):e.push("/onboarding/confirmed")}catch(e){p(e?.message||"Booking failed.")}finally{u(!1)}}return(0,t.useEffect)(()=>{o("nexus_terms")?o("nexus_lead")?x():e.push("/onboarding/details"):e.push("/onboarding/terms")},[]),(0,s.jsx)("div",{className:"section",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"badge",children:"Step 3 of 3"}),(0,s.jsx)("h1",{className:"h1",style:{fontSize:44,marginTop:12},children:"Book your onboarding call"}),(0,s.jsx)("p",{className:"p",children:"Select a slot below. Times are shown in your device time."}),(0,s.jsx)("div",{className:"card",style:{marginTop:14},children:c?(0,s.jsx)("div",{className:"p",children:"Loading slots..."}):0===n.length?(0,s.jsx)("div",{className:"p",children:"No slots available right now. Please check back later."}):(0,s.jsx)("div",{style:{display:"grid",gap:12},children:n.map(e=>{let t=r===e.id;return(0,s.jsx)("label",{className:"card",style:{cursor:"pointer",borderColor:t?"rgba(120,200,255,0.8)":"rgba(255,255,255,0.12)",background:t?"rgba(10,16,32,0.65)":"rgba(10,16,32,0.35)"},children:(0,s.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[(0,s.jsx)("input",{type:"radio",name:"slot",checked:t,onChange:()=>d(e.id)}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:800,fontSize:20},children:a(e.startsAt)}),(0,s.jsxs)("div",{className:"p",style:{marginTop:4,opacity:.85},children:["Ends: ",a(e.endsAt)]})]})]})},e.id)})})}),g&&(0,s.jsxs)("div",{className:"card",style:{borderColor:"rgba(255,120,120,0.6)",marginTop:14},children:[(0,s.jsx)("b",{style:{color:"#ffd4d4"},children:"Fix this"}),(0,s.jsx)("div",{className:"p",style:{marginTop:6},children:g})]}),b&&(0,s.jsxs)("div",{className:"card",style:{borderColor:"rgba(120,255,160,0.35)",marginTop:14},children:[(0,s.jsx)("b",{style:{color:"#d6ffe3"},children:"Done"}),(0,s.jsx)("div",{className:"p",style:{marginTop:6},children:b})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",marginTop:16},children:[(0,s.jsx)("button",{className:"btn btnGhost",onClick:()=>e.push("/onboarding/details"),children:"Back"}),(0,s.jsx)("button",{className:"btn btnPrimary",onClick:j,disabled:m||0===n.length,children:m?"Booking...":"Book"}),(0,s.jsx)("button",{className:"btn btnGhost",onClick:x,disabled:c,children:"Refresh slots"})]})]})})}e.s(["default",()=>n])}]);